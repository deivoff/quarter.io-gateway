module.exports=function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)__webpack_require__.d(r,a,function(t){return e[t]}.bind(null,a));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=9)}([function(e,t){e.exports=require("tslib")},function(e,t){e.exports=require("type-graphql")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0);a.__exportStar(r(5),t),a.__exportStar(r(20),t),a.__exportStar(r(21),t)},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("sequelize-typescript")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0),o=r(4),i=r(1);let n=class User extends o.Model{};a.__decorate([o.PrimaryKey,i.Field(),o.Default(o.DataType.UUIDV4),o.Column(o.DataType.UUID),a.__metadata("design:type",String)],n.prototype,"id",void 0),a.__decorate([i.Field({description:"Email of the user."}),o.Unique,o.Column,a.__metadata("design:type",String)],n.prototype,"email",void 0),a.__decorate([o.Column,a.__metadata("design:type",String)],n.prototype,"givenName",void 0),a.__decorate([o.Column,a.__metadata("design:type",String)],n.prototype,"familyName",void 0),a.__decorate([o.Column,a.__metadata("design:type",String)],n.prototype,"fatherName",void 0),a.__decorate([o.Column,a.__metadata("design:type",String)],n.prototype,"password",void 0),a.__decorate([i.Field(),o.CreatedAt,a.__metadata("design:type",Date)],n.prototype,"createdAt",void 0),a.__decorate([i.Field(),o.UpdatedAt,a.__metadata("design:type",Date)],n.prototype,"updatedAt",void 0),n=a.__decorate([i.ObjectType(),o.Table],n),t.User=n},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0),o=r(1);let i=class AuthData{};a.__decorate([o.Field(()=>o.ID),a.__metadata("design:type",String)],i.prototype,"_id",void 0),a.__decorate([o.Field(),a.__metadata("design:type",String)],i.prototype,"token",void 0),a.__decorate([o.Field(()=>o.Int),a.__metadata("design:type",Number)],i.prototype,"tokenExpiration",void 0),i=a.__decorate([o.ObjectType()],i),t.AuthData=i},function(e,t,r){e.exports=r(10)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0).__importDefault(r(11)),o=r(12),i=process.env.PORT||7e3;o.createApp().then(e=>a.default.createServer(e.callback()).listen(i)).then(()=>console.log(`App listening at port: ${i}`)).catch(e=>{console.error(e),process.exit(1)})},function(e,t){e.exports=require("http")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0);r(13);a.__importDefault(r(3));const o=a.__importDefault(r(14)),i=a.__importDefault(r(15)),n=a.__importDefault(r(16)),_=r(17),s=r(4),u=r(1),p=a.__importDefault(r(18)),c=a.__importDefault(r(19)),d=r(2),l=r(22),f=r(24);t.createApp=async()=>{const e=new o.default,t=new i.default;new s.Sequelize(process.env.DB_NAME,process.env.DB_USER,process.env.DB_PASSWORD,{dialect:"mysql",models:[d.User],host:process.env.DB_URL||""}).sync();const r=await u.buildSchema({resolvers:[l.AuthResolver,d.UserResolver],emitSchemaFile:!0,validate:!1});e.use(p.default({origin:"*",credentials:!0})),e.use(c.default()),e.use(async(e,t)=>{if(e.set("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, X-Requested-With, x-access-token"),e.set("Access-Control-Allow-Methods","POST, GET, PUT, DELETE, OPTIONS"),"OPTIONS"===e.method)return e.status=200;await t()}),e.use(n.default()),e.use(f.isAuth);const a=new _.ApolloServer({schema:r,context:e=>e,playground:!0,introspection:!0});return e.use(t.routes()),e.use(t.allowedMethods()),a.applyMiddleware({app:e,path:"/graphql"}),e}},function(e,t){e.exports=require("reflect-metadata")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("koa-logger")},function(e,t){e.exports=require("apollo-server-koa")},function(e,t){e.exports=require("@koa/cors")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0),o=a.__importStar(r(6)),i=r(5),n=r(1),_=r(2);let s=class UserResolver{async createUser({email:e,password:t,familyName:r,fatherName:a,givenName:n}){try{if(await i.User.findOne({where:{email:e}}))throw new Error("User is already exist!");const _=await o.hash(t,12),s=new i.User({email:e,familyName:r,fatherName:a,givenName:n,password:_});return await s.save()}catch(e){throw e}}};a.__decorate([n.Mutation(e=>i.User),a.__param(0,n.Arg("userInput",e=>_.UserInput)),a.__metadata("design:type",Function),a.__metadata("design:paramtypes",[_.UserInput]),a.__metadata("design:returntype",Promise)],s.prototype,"createUser",null),s=a.__decorate([n.Resolver(e=>i.User)],s),t.UserResolver=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0),o=r(1);let i=class UserInput{};a.__decorate([o.Field(),a.__metadata("design:type",String)],i.prototype,"email",void 0),a.__decorate([o.Field(),a.__metadata("design:type",String)],i.prototype,"givenName",void 0),a.__decorate([o.Field(),a.__metadata("design:type",String)],i.prototype,"familyName",void 0),a.__decorate([o.Field(),a.__metadata("design:type",String)],i.prototype,"fatherName",void 0),a.__decorate([o.Field(),a.__metadata("design:type",String)],i.prototype,"password",void 0),i=a.__decorate([o.InputType()],i),t.UserInput=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0);a.__exportStar(r(23),t),a.__exportStar(r(8),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0),o=a.__importStar(r(6)),i=a.__importStar(r(7)),n=r(8),_=r(1),s=r(2);let u=class AuthResolver{async login(e,t){try{const r=await s.User.findOne({where:{email:e}});if(!r)throw new Error("User is not exist!");if(!await o.compare(t,r.password))throw new Error("Password is incorrect!");const a=i.sign({_id:r.id,email:e,familyName:r.familyName,givenName:r.givenName,fatherName:r.fatherName},"somebody",{expiresIn:"1h"});return{_id:r.id,token:a,tokenExpiration:1}}catch(e){throw e}}};a.__decorate([_.Query(e=>n.AuthData),a.__param(0,_.Arg("email")),a.__param(1,_.Arg("password")),a.__metadata("design:type",Function),a.__metadata("design:paramtypes",[String,String]),a.__metadata("design:returntype",Promise)],u.prototype,"login",null),u=a.__decorate([_.Resolver(e=>n.AuthData)],u),t.AuthResolver=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0),o=a.__importDefault(r(3)),i=a.__importStar(r(7));r(25).config({path:o.default.join(`${__dirname}./../../../.env`)}),t.isAuth=async(e,t)=>{const r=e.header.authorization;if(!r)return e.state.isAuth=!1,await t();const a=r.split(" ")[1];if(!a||""===a)return e.state.isAuth=!1,await t();let o;try{o=i.verify(a,process.env.SECRET_KEY)}catch(r){return e.state.isAuth=!1,await t()}return o?(e.state.isAuth=!0,e.state.decodedUser=o,await t()):(e.state.isAuth=!1,await t())},t.checkAuth=e=>{if(!e.state.isAuth)throw new Error("Unauthenticated")}},function(e,t){e.exports=require("dotenv")}]);
//# sourceMappingURL=index.js.map